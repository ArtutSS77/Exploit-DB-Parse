from django.shortcuts import render
from django.http import HttpResponse
from .models import User
# Create your views here.

def update_filter(request):
    if request.method == 'POST':
        params = request.POST
        user = User.objects.filter(telegram_id=params['telegram_id'])
        if not user:
            user = User.objects.create(telegram_id=params['telegram_id'], filters=params['filter'])
        else:
            user = user.first()
            user.filters = params['filter']
        user.save()
        return HttpResponse(200)

def delete_filter(request):
    if request.method == 'POST':
        params = request.POST
        user = User.objects.filter(telegram_id=params['telegram_id']).first()
        user.filters = ".*"
        user.save()

def get_filter(request):
    telegram_id = request.GET['telegram_id']
    user = User.objects.filter(telegram_id=telegram_id).first()
    return HttpResponse(user.filters, content_type="text/plain")

